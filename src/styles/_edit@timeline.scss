@use "variable" as variable;

#timeline {
	//$timeline-header-id-width: 10ch;
	$timeline-header-id-width: 14ch;
	$timeline-header-subject-width: 15ch;
	$timeline-header-workload-width: 9ch;
	$timeline-header-resource-width: 9ch;
	$timeline-header-relation: 3ch;
	$timeline-header-range-from-width: 10.5ch;
	$timeline-header-range-to-width: 10.5ch;
	$timeline-header-progress-width: 7ch;
	$timeline-header-controls-item-width: 3ch;

	$app-header-height: 80px;
	$app-header-width: $timeline-header-id-width + $timeline-header-subject-width + $timeline-header-workload-width +
		$timeline-header-resource-width + $timeline-header-relation + $timeline-header-range-from-width +
		$timeline-header-range-to-width + $timeline-header-progress-width + $timeline-header-controls-item-width;

	display: grid;
	width: max-content;

	font-size: variable.$app-timeline-mode-font-size;

	* {
		font-size: variable.$app-timeline-mode-font-size;
	}

	.timeline-header {
		display: inline-flex;
		flex-direction: row;
		flex-wrap: nowrap;
		justify-content: center;

		.timeline-id {
			width: $timeline-header-id-width;
		}
		.timeline-subject {
			width: $timeline-header-subject-width;
		}
		.timeline-workload {
			width: $timeline-header-workload-width;
		}
		.timeline-resource {
			width: $timeline-header-resource-width;
		}
		.timeline-relation {
			width: $timeline-header-relation;
			text-align: center;
		}
		.timeline-range-from {
			width: $timeline-header-range-from-width;
			text-align: center;
		}
		.timeline-range-to {
			width: $timeline-header-range-to-width;
			text-align: center;
		}
		.timeline-range-area {
			width: $timeline-header-range-from-width + $timeline-header-range-to-width;
			text-align: center;
		}
		.timeline-progress {
			width: $timeline-header-progress-width;
		}
	}

	#cross-header {
		background-color: lime;

		z-index: 2;
		position: sticky;
		top: 0;
		left: 0;
		grid-row-start: 1;
		grid-column-start: 1;

		width: $app-header-width;
		height: $app-header-height;
	}

	#days-header {
		$base-background: pink;

		background-color: $base-background;

		z-index: 1;
		position: sticky;
		top: 0;
		grid-row-start: 1;
		grid-column-start: 2;

		height: $app-header-height;

		table {
			table-layout: fixed;
			border-collapse: collapse;
		}

		.cell {
			//filter: invert(100%) grayscale(100%) contrast(100);
			//filter: grayscale(1) contrast(9999) invert(1);
		}

		.year-month {
			td {
				position: sticky;
				left: $app-header-width;
				background-color: $base-background;
				// border: 1px solid black;

				// & + td {
				// 	border-right: 1px solid black;
				// }
				time {
					border-left: 1px dotted black;
				}
			}
		}

		.day {
			text-align: center;

			td {
				border: 1px solid black;
			}
		}

		.week {
			text-align: center;

			td {
				border: 1px solid black;
			}
		}

		.pin {
			text-align: center;

			td {
				border: 1px solid black;
			}
		}
	}

	#timelines {
		background: orange;

		z-index: 0;
		position: sticky;
		left: 0;
		grid-row-start: 2;
		grid-column-start: 1;
		width: $app-header-width;

		.task {
			.timeline-range-from,
			.timeline-range-to,
			.timeline-range-area {
				&.clickable {
					cursor: pointer;
				}
			}
		}

		.timeline-header {
			border-bottom: 1px dotted black;

			&.dragging {
				opacity: 0.8;
				filter: contrast(50%) grayscale(100%);
			}

			&.drag-over {
				position: relative;
				mix-blend-mode: overlay;
			}

			&.hover {
				position: relative;
				outline: 3px double rgba(255, 0, 0, 0.555);
			}

			.prompt {
				position: relative;

				background-color: palegoldenrod;
				outline: 2px palegoldenrod solid;
				height: fit-content;

				.tools {
					background-color: palegoldenrod;
					outline: 2px palegoldenrod solid;
					height: fit-content;

					width: max-content;

					&.before {
						position: absolute;
						right: 0;
						top: 0;
					}

					&.after {
						position: absolute;
						left: 100%;
						top: 0;
					}

					button {
						width: 100%;
					}
				}

				.overlay {
					&::before {
						z-index: 3;
						grid-row-start: 1;
						grid-column-start: 1;

						position: fixed;
						top: 0;
						left: 0;
						bottom: 0;
						right: 0;
						background-color: #28ddc5a4;
					}
				}
			}

			.timeline-id[draggable="true"] {
				$cursor: grab;

				cursor: $cursor;

				&.dragging {
					opacity: 1;
					color: black;
					background: whitesmoke;
					border: 1px solid gray;
				}

				* {
					cursor: $cursor;
				}
			}

			.timeline-range-area.prompt {
				.contents {
					display: flex;
					align-items: center;

					.main {
						flex: content;

						input {
							width: 100%;
						}
					}
				}
			}

			label {
				display: block;
			}

			.timeline-subject {
				input {
					width: 100%;
				}
			}

			.timeline-workload {
				input[type="number"] {
					width: 100%;
					text-align: right;
				}
			}

			.timeline-resource {
				select {
					width: 100%;
				}
			}

			.timeline-progress {
				input[type="number"] {
					width: 100%;
					text-align: right;
				}
			}

			.timeline-controls {
				button.simple {
					//width: $timeline-header-controls-item-width;
					padding: 0;
				}
			}
		}

		.task {
			& > .timeline-header {
				background-color: olivedrab;
			}
		}

		dialog.selector {
			table.previous {
				tr {
					&.self {
						background: gold;
					}
				}

				td {
					white-space: nowrap;

					& > label {
						display: block;
					}
				}
			}
		}
	}

	#viewer {
		width: 100%;
		height: 100%;

		grid-row-start: 2;
		grid-column-start: 2;

		svg {
			background: skyblue;
			width: 100%;
			height: 100%;
		}
	}
}
